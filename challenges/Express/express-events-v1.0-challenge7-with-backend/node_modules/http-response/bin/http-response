#!/usr/bin/env node

var get = require('../lib/get');
var parse = require('../lib/parse');
var print = require('../lib/print');
var http = require('../lib/http');
var file = require('../lib/file');
var config = require('../lib/config');

var processJSON = function(input) {
	input = input[codeNumber];
	if(!input) print.invalid();
	input.number = codeNumber;
	input.type = http.getCodeType(codeNumber);
	print.formatted(input);
};

if(process.argv[2]) {
	var codeNumber = process.argv[2];

	if(file.exists(config.CACHE)) {
		var result = JSON.parse(file.readFile(config.CACHE));
		processJSON(result);
	}

	else get.fromURL(config.URL, function(err, res) {		
		var result = parse.html(res);
		file.writeFile(config.CACHE, JSON.stringify(result));
		processJSON(result);
	});
} else print.help();


